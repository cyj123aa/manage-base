<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoolink.manage.base.dao.mapper.ext.ManageDepartmentMapperExt">

  <resultMap id="BaseResultMap" type="com.hoolink.sdk.bo.manager.ManageDepartmentTreeBO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="dept_name" jdbcType="VARCHAR" property="name" />
    <result column="dept_type" jdbcType="TINYINT" property="deptType" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
    <collection property="childTreeList" select="getOrganizationListByParentId" column="id"></collection>
  </resultMap>

    <!-- 获取所在公司或者部门-->
    <select id="getOrganizationList" resultMap="BaseResultMap">
        SELECT id, dept_name, dept_type, parent_id
        FROM manage_department md
        WHERE
        md.enabled = TRUE
        <if test="ids != null">
            AND md.id IN
            <foreach collection="ids" item="id" index="index" open="(" close=")" separator=",">
                #{id}
            </foreach>
        </if>
    </select>

    <!-- 再递归查询所在公司或者部门下的所有字部门-->
    <select id="getOrganizationListByParentId" resultMap="BaseResultMap">
        SELECT id, dept_name, dept_type, parent_id
        FROM manage_department md
        WHERE
        md.enabled = TRUE
        AND md.parent_id = #{id}
    </select>

</mapper>