<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoolink.manage.base.dao.mapper.ext.MiddleUserDepartmentMapperExt">

  <insert id="batchInsert" parameterType="java.util.List">
    insert into middle_user_department (user_id, dept_id, encry_level_dept
      )
    values
    <foreach collection="middleUserDeptList" item="userDeptPair" separator=",">
      (#{userDeptPair.userId},#{userDeptPair.deptId},#{userDeptPair.encryLevelDept})
    </foreach>
  </insert>

  <resultMap id="UserDeptMap" type="com.hoolink.manage.base.bo.UserDeptBO">
    <id column="company" jdbcType="VARCHAR" property="companyName" />
    <collection property="deptPositionBOS" ofType="com.hoolink.manage.base.bo.DeptPositionBO">
      <id column="id" jdbcType="BIGINT" property="id" />
      <result column="dept_name" jdbcType="VARCHAR" property="deptName" />
      <collection property="deptPositionBOList" ofType="com.hoolink.manage.base.bo.DeptPositionBO">
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="dept_name" jdbcType="VARCHAR" property="deptName" />
      </collection>
    </collection>
  </resultMap>

  <select id="getDeptMenu" resultMap="UserDeptMap">
    select mu.company,md.id,md.dept_name from manage_user mu
    left join middle_user_department mud on mu.id=mud.user_id
    left join manage_department md on mud.department_id=md.id
    left join manage_department mdept on mdept.parent_id=md.id
    where mu.enabled=true and mu.id=#{user_id}
    and md.enabled=true and mdept.enabled=true
  </select>

  <resultMap id="UserDeptInfoMap" type="com.hoolink.sdk.bo.manager.UserDeptInfoBO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="" jdbcType="INTEGER"  property="encryLevelCompany"/>
    <collection property="deptMap" resultMap="DeptInfoMap">
    </collection>
  </resultMap>

  <resultMap id="DeptInfoMap" type="java.util.Map">
    <result column="dept_id" property="deptId" />
    <result column="encry_level_dept" property="encryLevelDept" />
  </resultMap>

  <select id="getUserSecurity" resultMap="UserDeptInfoMap">
    select mu.id,mu.encry_level_company,mud.dept_id,mud.encry_level_dept from manage_user mu left join middle_user_department mud
    on mu.id=mud.user_id
    where mu.enabled=true and mu.id=#{user_id}
  </select>
</mapper>