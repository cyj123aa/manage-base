<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoolink.manage.base.dao.mapper.ext.MiddleUserDepartmentMapperExt">

  <insert id="batchInsert" parameterType="java.util.List">
    insert into middle_user_department (user_id, dept_id, encry_level_dept
      )
    values
    <foreach collection="middleUserDeptList" item="userDeptPair" separator=",">
      (#{userDeptPair.userId},#{userDeptPair.deptId},#{userDeptPair.encryLevelDept})
    </foreach>
  </insert>

  <resultMap id="UserCompanyMap" type="com.hoolink.manage.base.bo.DeptPositionBO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="dept_name" jdbcType="VARCHAR" property="deptName" />
    <result column="dept_type" jdbcType="TINYINT" property="deptType" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
  </resultMap>

  <select id="getDept" resultMap="UserCompanyMap">
    select md.id,md.dept_name,md.dept_type,md.parent_id from  middle_user_department mud
    left join manage_department md on mud.dept_id=md.id
    where mud.user_id=#{userId}
    and md.enabled=true
    order by md.created asc
  </select>

  <resultMap id="UserDeptInfoMap" type="com.hoolink.manage.base.bo.UserSecurityBO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="encry_level_company" jdbcType="INTEGER"  property="encryLevelCompany"/>
    <collection property="list" ofType="com.hoolink.manage.base.bo.DeptSecurityBO">
      <id column="dept_id" property="id" />
      <result column="encry_level_dept" property="encryLevelDept" />
      <result column="dept_type" property="deptType" />
    </collection>
  </resultMap>

  <select id="getUserSecurity" resultMap="UserDeptInfoMap">
    select mu.id,mu.encry_level_company,mud.dept_id,mud.encry_level_dept,md.dept_type from manage_user mu
    left join middle_user_department mud on mu.id=mud.user_id
    left join manage_department md on mud.dept_id=md.id
    where mu.enabled=true and mu.id=#{userId} and md.dept_type!=1
  </select>
</mapper>