<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hoolink.manage.base.dao.mapper.ext.MiddleUserDepartmentMapperExt">

  <insert id="batchInsert" parameterType="java.util.List">
    insert into middle_user_department (user_id, dept_id, encry_level_dept
      )
    values
    <foreach collection="middleUserDeptList" item="userDeptPair" separator=",">
      (#{userDeptPair.userId},#{userDeptPair.deptId},#{userDeptPair.encryLevelDept})
    </foreach>
  </insert>

  <resultMap id="UserDeptMap" type="com.hoolink.manage.base.bo.UserDeptBO">
    <id column="company" jdbcType="VARCHAR" property="companyName" />
    <collection property="deptMap" resultMap="DeptMap">
    </collection>
  </resultMap>

  <resultMap id="DeptMap" type="java.util.Map">
    <result column="id" property="id" />
    <result column="dept_name" property="deptName" />
  </resultMap>

  <select id="getDeptMenu" resultMap="UserDeptMap">
    select mu.company,mu.id,md.dept_name from manage_user mu left join middle_user_department mud
    left join manage_department md on mud.department_id=md.id
    on mu.id=mud.user_id
    where mu.enabled=true and mu.id=#{user_id}
  </select>

  <select id="getUserSecurity" resultMap="UserDeptMap">
    select mu.encry_level_company,mu.id,mu.dept_name from manage_user mu left join middle_user_department mud
    on mu.id=mud.user_id
    where mu.enabled=true and mu.id=#{user_id}
  </select>
</mapper>